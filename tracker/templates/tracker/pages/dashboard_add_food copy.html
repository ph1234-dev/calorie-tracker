{% extends 'tracker/index.html' %}

{% block content %}
  <div class="mx-auto flex gap-4 max-w-7xl justify-between">
    <section class="flex flex-col p-4 gap-4 flex-1">
      <h2>Your Food Entries Today</h2>
      <table class="text-left text-sm">
        <thead>
          <tr>
            <th class="border border-gray-200 px-2 py-1 w-1/3">Description</th>
            <th class="border border-gray-200 px-2 py-1 w-1/3">Calories</th>
            <th class="border border-gray-200 px-2 py-1 w-1/3">Serving Size</th>
            <th class="border border-gray-200 px-2 py-1 w-auto whitespace-nowrap">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for food in foods %}
            <tr>
              <td class="border border-gray-200 px-2 py-1">
                <div class="block">
                  <p>{{ food.description }}</p>
                  <p class="text-xs">{{ food.details }}</p>
                </div>
              </td>
              <td class="border border-gray-200 px-2 py-1">{{ food.estimated_calories }}</td>
              <td class="border border-gray-200 px-2 py-1">{{ food.serving_size }}</td>
              <td class="border border-gray-200 px-2 py-1">
                <div class="flex gap-1">
                  <button class="open-modal-btn px-3 py-1 rounded bg-lime-600 text-white/90" data-url="{% url 'tracker:update_food' food.id %}" data-year="{{ year }}" data-month="{{ month }}" data-day="{{ day }}">Update</button>
                  <form method="post" action="{% url 'tracker:delete_food' food.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="open-modal-btn px-3 py-1 rounded bg-rose-700 text-white/90">Delete</button>
                  </form>
                </div>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="5">No entries yet.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Reusable modal -->
      <div id="update-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-gray-100 rounded shadow-xl px-4 py-4 w-96 max-w-full relative">
          <!-- Header -->
          <h2 class="text-xl font-bold text-gray-800">Update Calories</h2>
          <p class="text-xs">Change the calorie amount for this food entry:</p>

          <!-- Form -->
          <form id="update-form" method="post" class="space-y-4">
            {% csrf_token %}
            <div>
              <label for="update" class="block text-sm mt-6 text-gray-700 font-medium mb-1">New Calories</label>
              <input type="number" name="update" id="update" min="0" placeholder="Enter new calories" required class="border border-gray-300 text-sm rounded px-4 py-2 w-full focus:outline-none focus:ring-0" />
            </div>

            <!-- Buttons -->
            <div class="flex justify-end gap-3 text-sm">
              <button type="button" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300" id="cancel-btn">Cancel</button>
              <button type="submit" class="px-4 py-2 rounded bg-blue-600 text-white font-semibold hover:bg-blue-700">Update</button>
            </div>
          </form>
        </div>
      </div>
    </section>

    <section class="w-4/12 bg-">
      <fieldset class="border border-gray-200 p-4 rounded">
        <legend class="font-semibold">Form Food for {{ selected_date|date:'M d, Y' }}</legend>

        <form method="post">
          {% csrf_token %}

          <div style="margin-bottom: 16px;">
            <label for="{{ form.description.id_for_label }}">Food Name</label><br />
            {{ form.description }}
            {% if form.description.errors %}
              <div style="color:red;">{{ form.description.errors }}</div>
            {% endif %}
          </div>

          <div style="margin-bottom: 16px;">
            <label for="{{ form.serving_size.id_for_label }}">Serving Size</label><br />
            {{ form.serving_size }}
            {% if form.serving_size.errors %}
              <div style="color:red;">{{ form.serving_size.errors }}</div>
            {% endif %}
          </div>

          <div style="margin-bottom: 16px;">
            <label for="{{ form.calories.id_for_label }}">Calories</label><br />
            {{ form.calories }}
            {% if form.calories.errors %}
              <div style="color:red;">{{ form.calories.errors }}</div>
            {% endif %}
          </div>

          <div style="margin-bottom: 16px;">
            <label for="{{ form.details.id_for_label }}">Notes (optional)</label><br />
            {{ form.details }}
            {% if form.details.errors %}
              <div style="color:red;">{{ form.details.errors }}</div>
            {% endif %}
          </div>

          <button type="submit" class="bg-emerald-600 text-white px-4 py-2 rounded mt-2">Add</button>
        </form>
      </fieldset>
    </section>
  </div>
{% endblock %}
